!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.template_lib=t():e.template_lib=t()}("undefined"!=typeof self?self:this,(function(){return(()=>{var e={71:(e,t,r)=>{t.Puppet=function(e){let t={Config:e,PuppeteerBrowser:null,PuppeteerPage:null};{let e=r(385);t.default_session_config=function(){return e.default_session_config()},t.start_session=async function(r){return e.start_session(t,r)},t.end_session=async function(){return e.end_session(t)},t.get_session_status=async function(){return e.get_session_status(t)}}{let e=r(630);t.navigate_to=async function(r){return e.navigate_to(t,r)},t.get_pages=async function(){return e.get_pages(t)},t.switch_to_page=async function(r={page_number:0,url:"",url_starts_with:"",has_selector:""}){return e.switch_to_page(t,r)}}{let e=r(770);t.get_page=async function(){return e.get_page(t)},t.get_page_url=async function(){return e.get_page_url(t)},t.get_page_content=async function(){return e.get_page_content(t)},t.get_page_image=async function(){return e.get_page_image(t)}}{let e=r(504);t.find_element=async function(r){return e.find_element(t,r)},t.modelize=async function(r){return e.modelize(t,r)},t.get_text=async function(r){return e.get_text(t,r)},t.get_table=async function(r){return e.get_table(t,r)}}{let e=r(818);t.click_on=async function(r,n={click_delay:!1,expects_navigation:!1}){return e.find_element(t,r,n)},t.send_text=async function(r,n){return e.modelize(t,r,n)}}{let e=r(339);t.has_selector=async function(r){return e.has_selector(t,r)},t.wait_for=async function(r){return e.wait_for(t,r)},t.wait_for_navigation=async function(r){return e.wait_for_navigation(t,r)}}return t}},339:(e,t)=>{"use strict";t.has_selector=async function(e,t){if(!e.PuppeteerBrowser)return{error:"Browser does not exist."};if(!e.PuppeteerPage)return{error:"Page does not exist."};let r=await e.find_element(e,t);return r.error?r:{has_selector:!!r.element}},t.wait_for=async function(e,t){return e.PuppeteerBrowser?e.PuppeteerPage?(t.startsWith("//")?await e.PuppeteerPage.waitForXPath(t):await e.PuppeteerPage.waitForSelector(t),{wait_for:!0}):{error:"Page does not exist."}:{error:"Browser does not exist."}},t.wait_for_navigation=async function(e,t){return e.PuppeteerBrowser?e.PuppeteerPage?(await e.PuppeteerPage.waitForNavigation(t),{wait_for_navigation:!0}):{error:"Page does not exist."}:{error:"Browser does not exist."}},t.wait_for_change=async function(e){return e.PuppeteerBrowser?e.PuppeteerPage?{wait_for_change:!1}:{error:"Page does not exist."}:{error:"Browser does not exist."}},t.wait_while_exists=async function(e){return e.PuppeteerBrowser?e.PuppeteerPage?{wait_while_exists:!1}:{error:"Page does not exist."}:{error:"Browser does not exist."}}},818:(e,t)=>{"use strict";t.click_on=async function(e,t,r={click_delay:!1,expects_navigation:!1}){if(!e.PuppeteerBrowser)return{error:"Browser does not exist."};if(!e.PuppeteerPage)return{error:"Page does not exist."};let n=await e.find_element(e,t);if(n.error)return n;if(!n.element)throw new Error(`Selector [${t}] does not exist.`);let o=n.element,s={};r.click_delay&&(s.delay=r.click_delay);let a=(await e.PuppeteerBrowser.pages()).length;await o.focus(),r.expects_navigation?await Promise.all([o.click(s),e.PuppeteerPage.waitForNavigation({waitUntil:"networkidle2"})]):await o.click(s);let i={click_on:!0};return(await e.PuppeteerBrowser.pages()).length>a&&(i.new_tab=!0),i},t.send_text=async function(e,t,r){if(!e.PuppeteerBrowser)return{error:"Browser does not exist."};if(!e.PuppeteerPage)return{error:"Page does not exist."};let n=await e.find_element(e,t);if(n.error)return n;if(!n.element)throw new Error(`Selector [${t}] does not exist.`);let o=n.element;return r=""+r,await o.type(r),{send_text:!0}}},504:(e,t)=>{"use strict";t.find_element=async function(e,t){if(!e.PuppeteerBrowser)return{error:"Browser does not exist."};if(!e.PuppeteerPage)return{error:"Page does not exist."};let r=null;return t.startsWith("xpath:")?(t=t.substr(6).trim(),r=await e.PuppeteerPage.$x(t)):t.startsWith("css:")?(t=t.substr(4).trim(),r=await e.PuppeteerPage.$(t)):(t=t.trim(),r=await e.PuppeteerPage.$(t)),Array.isArray(r)&&(r=r[0]),{find_element:!0,element:r}},t.modelize=async function(e,t){if(!e.PuppeteerBrowser)return{error:"Browser does not exist."};if(!e.PuppeteerPage)return{error:"Page does not exist."};let r=await e.find_element(e,t);if(r.error)return r;if(!r.element)throw new Error(`Selector [${t}] does not exist.`);let n=r.element;return{modelize:!0,model:await e.PuppeteerPage.evaluate((e=>function e(t){let r={};r.innerText=t.innerText,r.nodeName=t.nodeName,r.nodeType="",1===t.nodeType?r.nodeType="element":2===t.nodeType?r.nodeType="attribute":3===t.nodeType?r.nodeType="text":4===t.nodeType&&(r.nodeType="comment"),r.attributes={};for(let e=0;e<t.attributes.length;e++){let n=t.attributes[e];r.attributes[n.name]=n.value}r.children=[];for(let n=0;n<t.children.length;n++)r.children.push(e(t.children[n]));return 0===r.children.length&&(r.text=t.innerText),r}(e)),n)}},t.get_text=async function(e,t){if(!e.PuppeteerBrowser)return{error:"Browser does not exist."};if(!e.PuppeteerPage)return{error:"Page does not exist."};let r=await e.find_element(e,t);if(r.error)return r;if(!r.element)throw new Error(`Selector [${t}] does not exist.`);let n=r.element,o=await n.getProperty("textContent");return{get_text:!0,text:await o.jsonValue()}},t.get_table=async function(e,t){if(!e.PuppeteerBrowser)return{error:"Browser does not exist."};if(!e.PuppeteerPage)return{error:"Page does not exist."};let r=await e.libPuppeteer.find_element(e,t);if(r.error)return r;if(!r.element)throw new Error(`Selector [${t}] does not exist.`);let n=r.element,o=[],s=await n.$$("tr");for(let e=0;e<s.length;e++){let t=await s[e].$$("td");0===t.length&&(t=await s[e].$$("th"));let r=[];for(let e=0;e<t.length;e++){let n=await t[e].getProperty("textContent"),o=await n.jsonValue();r.push(o)}o.push(r)}return{get_table:!0,table:o}},t.get_image=async function(e){return{get_image:!1}}},770:(e,t)=>{"use strict";t.get_page=async function(e){return e.PuppeteerBrowser?e.PuppeteerPage?{get_page:!0,url:await e.PuppeteerPage.url(),content:await e.PuppeteerPage.content(),image:await e.PuppeteerPage.screenshot({fullPage:!0,encoding:"base64"})}:{error:"Page does not exist."}:{error:"Browser does not exist."}},t.get_page_url=async function(e){return e.PuppeteerBrowser?e.PuppeteerPage?{get_page_url:!0,url:await e.PuppeteerPage.url()}:{error:"Page does not exist."}:{error:"Browser does not exist."}},t.get_page_content=async function(e){return e.PuppeteerBrowser?e.PuppeteerPage?{get_page_content:!0,content:await e.PuppeteerPage.content()}:{error:"Page does not exist."}:{error:"Browser does not exist."}},t.get_page_image=async function(e){return e.PuppeteerBrowser?e.PuppeteerPage?{get_page_image:!0,image:await e.PuppeteerPage.screenshot({fullPage:!0,encoding:"base64"})}:{error:"Page does not exist."}:{error:"Browser does not exist."}}},385:(e,t,r)=>{"use strict";const n=r(838);t.default_session_config=s,t.start_session=async function(e,t){if(e.PuppeteerBrowser)return{error:"Session already exists!"};let a=s();t=t&&void 0!==t?n.merge_objects(a,t):a;let i=null,u=null;try{i=r(750)}catch(e){throw n.lib_missing_error("puppeteer"),e}try{u=r(634)}catch(e){throw n.lib_missing_error("puppeteer-extra"),e}if(t.stealth)try{let e=r(3);u.use(e())}catch(e){throw n.lib_missing_error("puppeteer-extra-plugin-stealth"),e}if(t.captcha)try{let e=r(684);u.use(e({provider:t.captcha_credentials}))}catch(e){throw n.lib_missing_error("puppeteer-extra-plugin-recaptcha"),e}let p={headless:t.headless,sloMo:t.slow_mo,slomo:t.slow_mo,defaultViewport:null,ignoreHTTPSErrors:!0,args:["--no-sandbox","--disable-setuid-sandbox","--disable-accelerated-2d-canvas","--disable-gpu","--disable-infobars","--window-position=0,0","--ignore-certifcate-errors","--ignore-certifcate-errors-spki-list"]};void 0===t.user_agent&&(t.user_agent=o),t.user_agent||(t.user_agent=o),p.args.push(`--user-agent="${t.user_agent}"`),e.PuppeteerBrowser=await u.launch(p);let l=await e.PuppeteerBrowser.pages();return 0===l.length&&await e.PuppeteerBrowser.newPage(),l=await e.PuppeteerBrowser.pages(),e.PuppeteerPage=l[l.length-1],{start_session:!0}},t.end_session=async function(e){return e.PuppeteerBrowser&&await e.PuppeteerBrowser.close(),e.PuppeteerBrowser=null,e.PuppeteerPage=null,{end_session:!0}},t.get_session_status=async function(e){return e.PuppeteerBrowser&&e.PuppeteerPage?{get_session_status:!0}:{get_session_status:!1}};const o="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3312.0 Safari/537.36";function s(){return{stealth:!1,captcha:!1,captcha_credentials:{id:"",token:""},headless:!1,slow_mo:0,user_agent:o}}},630:(e,t)=>{"use strict";t.navigate_to=async function(e,t){return e.PuppeteerBrowser?e.PuppeteerPage?(await Promise.all([e.PuppeteerPage.goto(t),e.PuppeteerPage.waitForNavigation({waitUntil:"networkidle0"})]),{navigate_to:!0}):{error:"Page does not exist."}:{error:"Browser does not exist."}},t.get_pages=async function(e){if(!e.PuppeteerBrowser)return{error:"Browser does not exist."};if(!e.PuppeteerPage)return{error:"Page does not exist."};let t=await e.PuppeteerBrowser.pages(),r=[];for(let e=0;e<t.length;e++){let n=t[e],o={number:e+1,url:await n.url()};r.push(o)}return{get_pages:!0,pages:r}},t.switch_to_page=async function(e,t={page_number:0,url:"",url_starts_with:"",has_selector:""}){if(!e.PuppeteerBrowser)return{error:"Browser does not exist."};if(!e.PuppeteerPage)return{error:"Page does not exist."};let r=await e.PuppeteerBrowser.pages(),n=-1;for(let e=0;e<r.length;e++){let o=r[e];if(t.page_number){if(t.page_number===e+1){n=e;break}}else if(t.url){if(await o.url()===t.url_starts_with){n=e;break}}else if(t.url_starts_with){if((await o.url()).startsWith(t.url_starts_with)){n=e;break}}else if(t.has_selector){let r=null;if(r=t.has_selector.startsWith("//")?await o.$x(t.has_selector):await o.$(t.has_selector),r){n=e;break}}}return n<0?{switch_to_page:!1,page_number:-1}:(e.PuppeteerPage=r[n],{switch_to_page:!0,page_number:n+1})},t.get_cookies=async function(e){return{get_cookies:!1}},t.set_cookies=async function(e){return{set_cookies:!1}}},838:(e,t,r)=>{"use strict";const n=r(747),o=r(417),s=r(605),a=r(211);function i(e,t,r){for(;e.indexOf(t)>=0;)e=e.replace(t,r);return e}function u(e){switch(typeof e){case"undefined":return!0;case"string":if(0===e.length)return!0;case"object":if(null===e)return!0;if(0===Object.keys(e).length)return!0}return!1}function p(e){return JSON.parse(JSON.stringify(e))}t.sleep=async function(e){return new Promise((t=>setTimeout(t,e)))},t.random=function(e,t){let r=t-e+1;return Math.floor(Math.random()*r+e)},t.unique_id=function(e=12){let t="abcdefghijklmnopqrstuvwxyz1234567890",r="abcdefghijklmnopqrstuvwxyz",n="";for(let s=0;s<e;s++)n+=0===s?r[o.randomInt(0,r.length-1)]:t[o.randomInt(0,t.length-1)];return n},t.read_json_file=function(e){let t=n.readFileSync(e,"utf8");return JSON.parse(t)},t.write_json_file=function(e,t){let r=JSON.stringify(t);n.writeFileSync(e,r)},t.replace_all=i,t.escape_string=function(e,t){return i(e,t,`\\${t}`)},t.value_missing_null_empty=u,t.value_exists=function(e){return!u(e)},t.merge_objects=function(e,t){let r=p(e);return function e(t,r){Object.keys(r).forEach((n=>{let o=t[n],s=r[n],a=typeof s;void 0===o?t[n]=p(s):"object"===a?Array.isArray(o)?t[n].push(...p(s)):null===s?t[n]=null:e(t[n],s):t[n]=p(s)}))}(r,t),r},t.clone_object=p,t.text_compare=function(e,t){return e==t?0:e>t?1:-1},t.text_compare_case_insensitive=function(e,t){let r=e.toLowerCase(),n=t.toLowerCase();return r==n?0:r>n?1:-1},t.path_parent_name=function(e){let t={type:"",path:e,delimiter:"",parent:"",name:""};t.path.startsWith("stores:")?(t.type="stores",t.path=t.path.substr(7)):t.path.startsWith("views:")&&(t.type="views",t.path=t.path.substr(6)),t.delimiter=t.path.substr(0,1);let r=t.path.split(t.delimiter);return t.name=r.pop(),t.parent=r.join(t.delimiter),t.path===t.delimiter&&""===t.parent&&""===t.name?t.name=t.delimiter:""===t.parent&&(t.parent=t.delimiter),t},t.get_url=async function(e,t){return new Promise(((e,r)=>{let n=null,o=new URL(t);if("http:"===o.protocol)n=s;else{if("https:"!==o.protocol)throw new Error(`Unknown protocol in [${t}]`);n=a}n.request(t,{method:"GET",headers:{Accept:"*/*"}},(t=>{let r=[];t.on("data",(e=>{r.push(e)})),t.on("end",(()=>{let t=Buffer.concat(r).toString("utf-8");e(t)}))})).on("error",(e=>{r(e)}))}))},t.lib_missing_error=function(e){return console.error(`LIB-WEB-AUTOMATION: An npm library required for this service provider [${e}] was not found.`),console.error(`LIB-WEB-AUTOMATION: The npm library [${e}] was not found.`),void console.error(`LIB-WEB-AUTOMATION: To install [${e}] please use: npm install --save ${e}`)}},417:e=>{"use strict";e.exports=require("crypto")},747:e=>{"use strict";e.exports=require("fs")},605:e=>{"use strict";e.exports=require("http")},211:e=>{"use strict";e.exports=require("https")},750:e=>{"use strict";e.exports=require("puppeteer")},634:e=>{"use strict";e.exports=require("puppeteer-extra")},684:e=>{"use strict";e.exports=require("puppeteer-extra-plugin-recaptcha")},3:e=>{"use strict";e.exports=require("puppeteer-extra-plugin-stealth")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}var n={};return(()=>{"use strict";n.Puppet=function(e){return r(71).Puppet(e)}})(),n})()}));